{"ast":null,"code":"var _jsxFileName = \"E:\\\\AN3\\\\SEM2\\\\project-MichiMauser\\\\frontend\\\\src\\\\pages\\\\webSocket\\\\WebSocketMsg.js\",\n  _s = $RefreshSig$();\nimport React, { useContext, useEffect, useState, useRef, useCallback } from 'react';\nimport { Button, Form, Dropdown, ListGroup, Container, Row, Col, Alert } from 'react-bootstrap';\nimport axios from 'axios';\nimport SockJS from 'sockjs-client';\nimport { Stomp } from '@stomp/stompjs';\nimport NavBar from \"../../components/Navbar\";\nimport { LoggedUserContext } from '../../context/LoggedUserContext';\nimport \"../../styles/ChatGroup.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction GroupChatApp() {\n  _s();\n  const [groups, setGroups] = useState([]);\n  const [selectedGroup, setSelectedGroup] = useState('');\n  const [messages, setMessages] = useState([]);\n  const [inputValue, setInputValue] = useState('');\n  const [notifications, setNotifications] = useState([]);\n  const [unreadNotifications, setUnreadNotifications] = useState(0);\n  const {\n    loggedUser\n  } = useContext(LoggedUserContext);\n  const stompClient = useRef(null);\n  const [isConnected, setIsConnected] = useState(false);\n  const currentGroupSubscription = useRef(null); // To manage group-specific subscription\n\n  // --- Helper Functions (Ensuring they are defined in scope) ---\n\n  // Fetch groups function\n  const fetchGroups = async () => {\n    try {\n      const response = await axios.get('http://localhost:8080/group');\n      setGroups(response.data);\n    } catch (err) {\n      console.error('GET /group failed:', err);\n    }\n  };\n\n  // Remove notification (using useCallback for optimization)\n  const removeNotification = useCallback(notificationId => {\n    setNotifications(prev => {\n      const notification = prev.find(n => n.id === notificationId);\n      if (notification && !notification.read) {\n        setUnreadNotifications(count => Math.max(0, count - 1));\n      }\n      return prev.filter(n => n.id !== notificationId);\n    });\n  }, []); // No dependencies as it operates on internal state setters\n\n  // Mark notification as read (using useCallback for optimization)\n  const markNotificationAsRead = useCallback(notificationId => {\n    setNotifications(prev => prev.map(n => {\n      if (n.id === notificationId && !n.read) {\n        setUnreadNotifications(count => Math.max(0, count - 1));\n        return {\n          ...n,\n          read: true\n        };\n      }\n      return n;\n    }));\n  }, []); // No dependencies as it operates on internal state setters\n\n  // Switch to group from notification (using useCallback for optimization)\n  const switchToGroupFromNotification = useCallback((groupName, notificationId) => {\n    setSelectedGroup(groupName);\n    markNotificationAsRead(notificationId);\n  }, [markNotificationAsRead]); // Depends on markNotificationAsRead\n\n  // Helper function to display message text reliably\n  const getMessageText = useCallback(msg => {\n    return msg.content || msg.text || msg.message || '[No message]';\n  }, []);\n\n  // Helper function to format timestamp\n  const formatTimestamp = useCallback(timestamp => {\n    if (!timestamp) return '';\n    const date = new Date(timestamp);\n    const now = new Date();\n    const isToday = date.toDateString() === now.toDateString();\n    if (isToday) {\n      return date.toLocaleTimeString([], {\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    } else {\n      return date.toLocaleString([], {\n        month: 'short',\n        day: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    }\n  }, []);\n\n  // Request Notification Permission (for desktop notifications)\n  const requestDesktopNotificationPermission = () => {\n    if (!(\"Notification\" in window)) {\n      console.warn(\"This browser does not support desktop notification\");\n    } else if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {\n      Notification.requestPermission().then(permission => {\n        if (permission === \"granted\") {\n          console.log(\"Desktop notification permission granted.\");\n        } else {\n          console.warn(\"Desktop notification permission denied.\");\n        }\n      });\n    }\n  };\n\n  // --- WebSocket Connection Setup (Runs once on mount) ---\n  useEffect(() => {\n    const socket = new SockJS('http://localhost:8080/socket');\n    stompClient.current = Stomp.over(socket);\n    stompClient.current.connect({}, frame => {\n      console.log('Connected to WebSocket:', frame);\n      setIsConnected(true);\n\n      // Subscribe to GLOBAL notifications\n      stompClient.current.subscribe('/topic/notifications', message => {\n        const notification = JSON.parse(message.body);\n        handleWebSocketNotification(notification);\n      });\n    }, error => {\n      console.error('WebSocket connection error:', error);\n      setIsConnected(false);\n      // In a real app, you might want to implement a reconnect strategy here\n    });\n\n    // Cleanup: Disconnect WebSocket when component unmounts\n    return () => {\n      if (stompClient.current && stompClient.current.connected) {\n        stompClient.current.disconnect(() => {\n          console.log(\"WebSocket disconnected.\");\n        });\n      }\n    };\n  }, []); // Empty dependency array means this effect runs only once on mount\n\n  // --- Handle Incoming WebSocket Notifications (Callback for reusability) ---\n  const handleWebSocketNotification = useCallback(notification => {\n    if (notification.type === 'NEW_MESSAGE') {\n      const currentUserFullName = loggedUser ? `${loggedUser.firstName} ${loggedUser.lastName}` : null;\n\n      // Don't show notification for your own messages\n      if (currentUserFullName && notification.sender === currentUserFullName) {\n        return;\n      }\n\n      // Get the ID of the currently selected group\n      const currentSelectedGroupObject = groups.find(g => g.name === selectedGroup);\n      const currentSelectedGroupId = currentSelectedGroupObject ? currentSelectedGroupObject.id : null;\n\n      // If user is NOT viewing this group, process as a notification\n      if (!currentSelectedGroupId || currentSelectedGroupId !== notification.groupId) {\n        const newNotification = {\n          id: Date.now(),\n          // Unique ID for React key and dismissal\n          type: 'message',\n          groupName: notification.groupName,\n          groupId: notification.groupId,\n          sender: notification.sender,\n          message: notification.message,\n          timestamp: new Date(notification.timestamp),\n          read: false\n        };\n        setNotifications(prev => [newNotification, ...prev].slice(0, 10)); // Keep only 10 latest\n        setUnreadNotifications(prev => prev + 1);\n\n        // Auto-remove app-level notification after 10 seconds\n        setTimeout(() => {\n          removeNotification(newNotification.id);\n        }, 10000);\n\n        // --- Trigger Desktop Notification (Optional) ---\n        if (\"Notification\" in window && Notification.permission === \"granted\") {\n          const title = `New Message in ${notification.groupName} from ${notification.sender}`;\n          const options = {\n            body: notification.message,\n            icon: '/path/to/your/chat-icon.png',\n            // Path to a small icon for the notification\n            tag: `group-chat-${notification.groupId}` // Groups notifications for the same chat\n            // vibrate: [200, 100, 200], // Optional: for mobile\n          };\n          const desktopNotif = new Notification(title, options);\n          desktopNotif.onclick = function () {\n            window.focus(); // Bring the browser tab to focus\n            // You can also programmatically switch the selected group if the user clicks the notification\n            if (newNotification.groupName) {\n              setSelectedGroup(newNotification.groupName);\n            }\n            markNotificationAsRead(newNotification.id); // Mark the in-app notification as read\n            desktopNotif.close(); // Close the desktop notification\n          };\n        }\n      }\n    }\n  }, [loggedUser, selectedGroup, groups, removeNotification, markNotificationAsRead]); // Dependencies for useCallback\n\n  // --- Fetch Groups on Component Mount ---\n  useEffect(() => {\n    fetchGroups();\n  }, []);\n\n  // --- Effect for Handling Group Selection and Subscribing to Group-Specific Messages ---\n  useEffect(() => {\n    // Condition to ensure we have a client and are connected before subscribing\n    if (!stompClient.current || !isConnected) {\n      if (currentGroupSubscription.current) {\n        currentGroupSubscription.current.unsubscribe();\n        currentGroupSubscription.current = null;\n      }\n      setMessages([]);\n      return;\n    }\n    const group = groups.find(g => g.name === selectedGroup);\n\n    // If no group is selected or the selected group isn't found\n    if (!selectedGroup || !group) {\n      if (currentGroupSubscription.current) {\n        currentGroupSubscription.current.unsubscribe();\n        currentGroupSubscription.current = null;\n      }\n      setMessages([]); // Clear messages when no group is selected\n      return;\n    }\n\n    // Fetch initial messages for the selected group\n    const fetchInitialMessages = async () => {\n      try {\n        const res = await axios.get(`http://localhost:8080/message/${group.id}`);\n        setMessages(res.data);\n      } catch (err) {\n        console.error('Error fetching initial messages for group:', err);\n      }\n    };\n    fetchInitialMessages();\n\n    // Unsubscribe from previous group's topic if any active subscription exists\n    if (currentGroupSubscription.current) {\n      currentGroupSubscription.current.unsubscribe();\n    }\n\n    // Subscribe to the specific group's chat topic for real-time updates\n    const subscription = stompClient.current.subscribe(`/topic/group/${group.id}`, message => {\n      const newMessage = JSON.parse(message.body);\n      // Only add if it's truly for the current group (defensive check)\n      if (newMessage.group && newMessage.group.id === group.id) {\n        setMessages(prevMessages => [...prevMessages, newMessage]);\n      }\n    });\n    currentGroupSubscription.current = subscription; // Store the new subscription object\n\n    // Cleanup function for when the component unmounts or selectedGroup/isConnected changes\n    return () => {\n      if (currentGroupSubscription.current) {\n        currentGroupSubscription.current.unsubscribe();\n        currentGroupSubscription.current = null;\n      }\n    };\n  }, [selectedGroup, groups, isConnected]); // Re-run this effect when selectedGroup, groups, or connection status changes\n\n  // --- Handlers for User Actions ---\n\n  const handleSend = async () => {\n    if (!inputValue.trim() || !selectedGroup || !stompClient.current || !isConnected) return;\n    const group = groups.find(g => g.name === selectedGroup);\n    if (!group) {\n      console.error(\"Selected group not found\");\n      return;\n    }\n    const messagePayload = {\n      sender: `${loggedUser.firstName} ${loggedUser.lastName}`,\n      message: inputValue\n      // You might include groupId in the message model on backend if needed for more complex routing\n      // but for simplicity, groupChatId is passed as a request param in the current backend\n    };\n    try {\n      // Send message via HTTP POST for persistence\n      await axios.post(`http://localhost:8080/message/post?groupChatId=${group.id}`, messagePayload);\n\n      // Clear input only after successful send\n      setInputValue('');\n      // The new message will be pushed via WebSocket to `/topic/group/{groupId}`\n      // and handled by the subscription in the useEffect above, so no need to re-fetch all messages here.\n    } catch (err) {\n      console.error('Sending message failed:', err);\n    }\n  };\n  const handleCreateGroup = async e => {\n    e.preventDefault();\n    if (!inputValue.trim()) return;\n    try {\n      await axios.post('http://localhost:8080/group/create', {\n        name: inputValue\n      });\n      await fetchGroups(); // Re-fetch groups to update the dropdown\n      setSelectedGroup(inputValue); // Automatically select the newly created group\n      setInputValue('');\n    } catch (err) {\n      console.error('Create group error:', err);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"group-chat-container\",\n    children: [/*#__PURE__*/_jsxDEV(NavBar, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 311,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Container, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"chat-main-card\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"d-flex justify-content-between align-items-center mb-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            className: \"chat-header\",\n            children: \"\\uD83D\\uDCAC Group Chat\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"connection-status\",\n            children: [isConnected ? /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-success\",\n              children: \"\\uD83D\\uDFE2 Connected\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 318,\n              columnNumber: 33\n            }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"text-danger\",\n              children: \"\\uD83D\\uDD34 Disconnected\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outline-primary\",\n              size: \"sm\",\n              className: \"ms-3\",\n              onClick: requestDesktopNotificationPermission,\n              title: \"Enable browser pop-up notifications\",\n              children: \"Get Desktop Notifications \\uD83D\\uDD14\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 322,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 316,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 21\n        }, this), notifications.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"notifications-bar mb-3 p-3 border rounded shadow-sm\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"d-flex justify-content-between align-items-center mb-2\",\n            children: /*#__PURE__*/_jsxDEV(\"h6\", {\n              className: \"mb-0\",\n              children: [\"\\uD83D\\uDD14 Live Notifications\", unreadNotifications > 0 && /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"badge bg-danger ms-2\",\n                children: unreadNotifications\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 341,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 338,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 337,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"notifications-list\",\n            children: [notifications.slice(0, 3).map(notification => /*#__PURE__*/_jsxDEV(Alert, {\n              variant: notification.read ? \"secondary\" : \"info\",\n              className: \"notification-alert mb-2\",\n              dismissible: true,\n              onClose: () => removeNotification(notification.id),\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"d-flex justify-content-between align-items-start\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"notification-content flex-grow-1\",\n                  style: {\n                    cursor: 'pointer'\n                  },\n                  onClick: () => switchToGroupFromNotification(notification.groupName, notification.id),\n                  children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: notification.sender\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 360,\n                    columnNumber: 49\n                  }, this), \" in \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: notification.groupName\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 360,\n                    columnNumber: 91\n                  }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 361,\n                    columnNumber: 49\n                  }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                    children: notification.message\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 362,\n                    columnNumber: 49\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 355,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n                  className: \"text-muted ms-2\",\n                  children: formatTimestamp(notification.timestamp)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 364,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 354,\n                columnNumber: 41\n              }, this)\n            }, notification.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 347,\n              columnNumber: 37\n            }, this)), notifications.length > 3 && /*#__PURE__*/_jsxDEV(\"small\", {\n              className: \"text-muted\",\n              children: [\"+\", notifications.length - 3, \" more notifications...\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 371,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"group-controls mb-4\",\n          children: /*#__PURE__*/_jsxDEV(Row, {\n            children: [/*#__PURE__*/_jsxDEV(Col, {\n              md: 6,\n              className: \"mb-3 mb-md-0\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"group-dropdown\",\n                children: /*#__PURE__*/_jsxDEV(Dropdown, {\n                  onSelect: setSelectedGroup,\n                  children: [/*#__PURE__*/_jsxDEV(Dropdown.Toggle, {\n                    className: \"w-100\",\n                    children: selectedGroup || 'Select Group'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 384,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(Dropdown.Menu, {\n                    children: groups.map((g, i) => /*#__PURE__*/_jsxDEV(Dropdown.Item, {\n                      eventKey: g.name,\n                      children: g.name\n                    }, i, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 389,\n                      columnNumber: 49\n                    }, this))\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 387,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 383,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 382,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 381,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(Col, {\n              md: 6,\n              children: /*#__PURE__*/_jsxDEV(Form, {\n                onSubmit: handleCreateGroup,\n                className: \"create-group-form d-flex\",\n                children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n                  type: \"text\",\n                  placeholder: \"Create new group...\",\n                  value: inputValue,\n                  onChange: e => setInputValue(e.target.value),\n                  className: \"create-group-input me-2\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 398,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  type: \"submit\",\n                  className: \"create-group-btn\",\n                  children: \"\\u2728 Create Group\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 405,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 397,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 396,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 21\n        }, this), selectedGroup ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-section card p-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n            className: \"chat-title mb-3\",\n            children: [\"\\uD83D\\uDCE8 Messages in \", selectedGroup]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(ListGroup, {\n            className: \"messages-container flex-grow-1 mb-3\",\n            children: messages.length > 0 ? messages.map((msg, idx) => /*#__PURE__*/_jsxDEV(ListGroup.Item, {\n              // Use msg.id if available for better keying\n              className: `message-item ${msg.sender === `${loggedUser.firstName} ${loggedUser.lastName}` ? 'my-message' : 'other-message'}`,\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"message-content\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"message-text\",\n                  children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"message-sender\",\n                    children: msg.sender === `${loggedUser.firstName} ${loggedUser.lastName}` ? 'You' : msg.sender || 'Unknown'\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 424,\n                    columnNumber: 49\n                  }, this), getMessageText(msg)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 423,\n                  columnNumber: 45\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"message-timestamp\",\n                  children: formatTimestamp(msg.timestamp)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 429,\n                  columnNumber: 45\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 422,\n                columnNumber: 41\n              }, this)\n            }, msg.id || idx, false, {\n              fileName: _jsxFileName,\n              lineNumber: 418,\n              columnNumber: 37\n            }, this)) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"empty-state\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"empty-state-icon\",\n                children: \"\\uD83D\\uDCAD\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 436,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                children: \"No messages yet. Start the conversation!\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 437,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 435,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(Form, {\n            className: \"message-input-form d-flex\",\n            onSubmit: e => {\n              e.preventDefault();\n              handleSend();\n            },\n            children: [/*#__PURE__*/_jsxDEV(Form.Control, {\n              type: \"text\",\n              placeholder: \"Type your message...\",\n              value: inputValue,\n              onChange: e => setInputValue(e.target.value),\n              className: \"message-input me-2\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 443,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              type: \"submit\",\n              className: \"send-btn\",\n              children: \"Send \\uD83D\\uDE80\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 450,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 442,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 25\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"empty-state card p-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"empty-state-icon\",\n            children: \"\\uD83D\\uDC46\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 457,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Select a group to start chatting!\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 458,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 456,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 310,\n    columnNumber: 9\n  }, this);\n}\n_s(GroupChatApp, \"fPbUC1uXiaEhx+LS3kL118lMmO8=\");\n_c = GroupChatApp;\nexport default GroupChatApp;\nvar _c;\n$RefreshReg$(_c, \"GroupChatApp\");","map":{"version":3,"names":["React","useContext","useEffect","useState","useRef","useCallback","Button","Form","Dropdown","ListGroup","Container","Row","Col","Alert","axios","SockJS","Stomp","NavBar","LoggedUserContext","jsxDEV","_jsxDEV","GroupChatApp","_s","groups","setGroups","selectedGroup","setSelectedGroup","messages","setMessages","inputValue","setInputValue","notifications","setNotifications","unreadNotifications","setUnreadNotifications","loggedUser","stompClient","isConnected","setIsConnected","currentGroupSubscription","fetchGroups","response","get","data","err","console","error","removeNotification","notificationId","prev","notification","find","n","id","read","count","Math","max","filter","markNotificationAsRead","map","switchToGroupFromNotification","groupName","getMessageText","msg","content","text","message","formatTimestamp","timestamp","date","Date","now","isToday","toDateString","toLocaleTimeString","hour","minute","toLocaleString","month","day","requestDesktopNotificationPermission","window","warn","Notification","permission","requestPermission","then","log","socket","current","over","connect","frame","subscribe","JSON","parse","body","handleWebSocketNotification","connected","disconnect","type","currentUserFullName","firstName","lastName","sender","currentSelectedGroupObject","g","name","currentSelectedGroupId","groupId","newNotification","slice","setTimeout","title","options","icon","tag","desktopNotif","onclick","focus","close","unsubscribe","group","fetchInitialMessages","res","subscription","newMessage","prevMessages","handleSend","trim","messagePayload","post","handleCreateGroup","e","preventDefault","className","children","fileName","_jsxFileName","lineNumber","columnNumber","variant","size","onClick","length","dismissible","onClose","style","cursor","md","onSelect","Toggle","Menu","i","Item","eventKey","onSubmit","Control","placeholder","value","onChange","target","idx","_c","$RefreshReg$"],"sources":["E:/AN3/SEM2/project-MichiMauser/frontend/src/pages/webSocket/WebSocketMsg.js"],"sourcesContent":["import React, { useContext, useEffect, useState, useRef, useCallback } from 'react';\r\nimport { Button, Form, Dropdown, ListGroup, Container, Row, Col, Alert } from 'react-bootstrap';\r\nimport axios from 'axios';\r\nimport SockJS from 'sockjs-client';\r\nimport { Stomp } from '@stomp/stompjs';\r\nimport NavBar from \"../../components/Navbar\";\r\nimport { LoggedUserContext } from '../../context/LoggedUserContext';\r\nimport \"../../styles/ChatGroup.css\";\r\n\r\nfunction GroupChatApp() {\r\n    const [groups, setGroups] = useState([]);\r\n    const [selectedGroup, setSelectedGroup] = useState('');\r\n    const [messages, setMessages] = useState([]);\r\n    const [inputValue, setInputValue] = useState('');\r\n    const [notifications, setNotifications] = useState([]);\r\n    const [unreadNotifications, setUnreadNotifications] = useState(0);\r\n    const { loggedUser } = useContext(LoggedUserContext);\r\n    const stompClient = useRef(null);\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const currentGroupSubscription = useRef(null); // To manage group-specific subscription\r\n\r\n    // --- Helper Functions (Ensuring they are defined in scope) ---\r\n\r\n    // Fetch groups function\r\n    const fetchGroups = async () => {\r\n        try {\r\n            const response = await axios.get('http://localhost:8080/group');\r\n            setGroups(response.data);\r\n        } catch (err) {\r\n            console.error('GET /group failed:', err);\r\n        }\r\n    };\r\n\r\n    // Remove notification (using useCallback for optimization)\r\n    const removeNotification = useCallback((notificationId) => {\r\n        setNotifications(prev => {\r\n            const notification = prev.find(n => n.id === notificationId);\r\n            if (notification && !notification.read) {\r\n                setUnreadNotifications(count => Math.max(0, count - 1));\r\n            }\r\n            return prev.filter(n => n.id !== notificationId);\r\n        });\r\n    }, []); // No dependencies as it operates on internal state setters\r\n\r\n    // Mark notification as read (using useCallback for optimization)\r\n    const markNotificationAsRead = useCallback((notificationId) => {\r\n        setNotifications(prev => prev.map(n => {\r\n            if (n.id === notificationId && !n.read) {\r\n                setUnreadNotifications(count => Math.max(0, count - 1));\r\n                return { ...n, read: true };\r\n            }\r\n            return n;\r\n        }));\r\n    }, []); // No dependencies as it operates on internal state setters\r\n\r\n    // Switch to group from notification (using useCallback for optimization)\r\n    const switchToGroupFromNotification = useCallback((groupName, notificationId) => {\r\n        setSelectedGroup(groupName);\r\n        markNotificationAsRead(notificationId);\r\n    }, [markNotificationAsRead]); // Depends on markNotificationAsRead\r\n\r\n    // Helper function to display message text reliably\r\n    const getMessageText = useCallback((msg) => {\r\n        return msg.content || msg.text || msg.message || '[No message]';\r\n    }, []);\r\n\r\n    // Helper function to format timestamp\r\n    const formatTimestamp = useCallback((timestamp) => {\r\n        if (!timestamp) return '';\r\n\r\n        const date = new Date(timestamp);\r\n        const now = new Date();\r\n        const isToday = date.toDateString() === now.toDateString();\r\n\r\n        if (isToday) {\r\n            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });\r\n        } else {\r\n            return date.toLocaleString([], {\r\n                month: 'short',\r\n                day: 'numeric',\r\n                hour: '2-digit',\r\n                minute: '2-digit'\r\n            });\r\n        }\r\n    }, []);\r\n\r\n    // Request Notification Permission (for desktop notifications)\r\n    const requestDesktopNotificationPermission = () => {\r\n        if (!(\"Notification\" in window)) {\r\n            console.warn(\"This browser does not support desktop notification\");\r\n        } else if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {\r\n            Notification.requestPermission().then(permission => {\r\n                if (permission === \"granted\") {\r\n                    console.log(\"Desktop notification permission granted.\");\r\n                } else {\r\n                    console.warn(\"Desktop notification permission denied.\");\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n\r\n    // --- WebSocket Connection Setup (Runs once on mount) ---\r\n    useEffect(() => {\r\n        const socket = new SockJS('http://localhost:8080/socket');\r\n        stompClient.current = Stomp.over(socket);\r\n\r\n        stompClient.current.connect({}, (frame) => {\r\n            console.log('Connected to WebSocket:', frame);\r\n            setIsConnected(true);\r\n\r\n            // Subscribe to GLOBAL notifications\r\n            stompClient.current.subscribe('/topic/notifications', (message) => {\r\n                const notification = JSON.parse(message.body);\r\n                handleWebSocketNotification(notification);\r\n            });\r\n        }, (error) => {\r\n            console.error('WebSocket connection error:', error);\r\n            setIsConnected(false);\r\n            // In a real app, you might want to implement a reconnect strategy here\r\n        });\r\n\r\n        // Cleanup: Disconnect WebSocket when component unmounts\r\n        return () => {\r\n            if (stompClient.current && stompClient.current.connected) {\r\n                stompClient.current.disconnect(() => {\r\n                    console.log(\"WebSocket disconnected.\");\r\n                });\r\n            }\r\n        };\r\n    }, []); // Empty dependency array means this effect runs only once on mount\r\n\r\n\r\n    // --- Handle Incoming WebSocket Notifications (Callback for reusability) ---\r\n    const handleWebSocketNotification = useCallback((notification) => {\r\n        if (notification.type === 'NEW_MESSAGE') {\r\n            const currentUserFullName = loggedUser ? `${loggedUser.firstName} ${loggedUser.lastName}` : null;\r\n\r\n            // Don't show notification for your own messages\r\n            if (currentUserFullName && notification.sender === currentUserFullName) {\r\n                return;\r\n            }\r\n\r\n            // Get the ID of the currently selected group\r\n            const currentSelectedGroupObject = groups.find(g => g.name === selectedGroup);\r\n            const currentSelectedGroupId = currentSelectedGroupObject ? currentSelectedGroupObject.id : null;\r\n\r\n            // If user is NOT viewing this group, process as a notification\r\n            if (!currentSelectedGroupId || currentSelectedGroupId !== notification.groupId) {\r\n                const newNotification = {\r\n                    id: Date.now(), // Unique ID for React key and dismissal\r\n                    type: 'message',\r\n                    groupName: notification.groupName,\r\n                    groupId: notification.groupId,\r\n                    sender: notification.sender,\r\n                    message: notification.message,\r\n                    timestamp: new Date(notification.timestamp),\r\n                    read: false\r\n                };\r\n\r\n                setNotifications(prev => [newNotification, ...prev].slice(0, 10)); // Keep only 10 latest\r\n                setUnreadNotifications(prev => prev + 1);\r\n\r\n                // Auto-remove app-level notification after 10 seconds\r\n                setTimeout(() => {\r\n                    removeNotification(newNotification.id);\r\n                }, 10000);\r\n\r\n                // --- Trigger Desktop Notification (Optional) ---\r\n                if (\"Notification\" in window && Notification.permission === \"granted\") {\r\n                    const title = `New Message in ${notification.groupName} from ${notification.sender}`;\r\n                    const options = {\r\n                        body: notification.message,\r\n                        icon: '/path/to/your/chat-icon.png', // Path to a small icon for the notification\r\n                        tag: `group-chat-${notification.groupId}`, // Groups notifications for the same chat\r\n                        // vibrate: [200, 100, 200], // Optional: for mobile\r\n                    };\r\n                    const desktopNotif = new Notification(title, options);\r\n\r\n                    desktopNotif.onclick = function() {\r\n                        window.focus(); // Bring the browser tab to focus\r\n                        // You can also programmatically switch the selected group if the user clicks the notification\r\n                        if (newNotification.groupName) {\r\n                            setSelectedGroup(newNotification.groupName);\r\n                        }\r\n                        markNotificationAsRead(newNotification.id); // Mark the in-app notification as read\r\n                        desktopNotif.close(); // Close the desktop notification\r\n                    };\r\n                }\r\n            }\r\n        }\r\n    }, [loggedUser, selectedGroup, groups, removeNotification, markNotificationAsRead]); // Dependencies for useCallback\r\n\r\n\r\n    // --- Fetch Groups on Component Mount ---\r\n    useEffect(() => {\r\n        fetchGroups();\r\n    }, []);\r\n\r\n\r\n    // --- Effect for Handling Group Selection and Subscribing to Group-Specific Messages ---\r\n    useEffect(() => {\r\n        // Condition to ensure we have a client and are connected before subscribing\r\n        if (!stompClient.current || !isConnected) {\r\n            if (currentGroupSubscription.current) {\r\n                currentGroupSubscription.current.unsubscribe();\r\n                currentGroupSubscription.current = null;\r\n            }\r\n            setMessages([]);\r\n            return;\r\n        }\r\n\r\n        const group = groups.find(g => g.name === selectedGroup);\r\n\r\n        // If no group is selected or the selected group isn't found\r\n        if (!selectedGroup || !group) {\r\n            if (currentGroupSubscription.current) {\r\n                currentGroupSubscription.current.unsubscribe();\r\n                currentGroupSubscription.current = null;\r\n            }\r\n            setMessages([]); // Clear messages when no group is selected\r\n            return;\r\n        }\r\n\r\n        // Fetch initial messages for the selected group\r\n        const fetchInitialMessages = async () => {\r\n            try {\r\n                const res = await axios.get(`http://localhost:8080/message/${group.id}`);\r\n                setMessages(res.data);\r\n            } catch (err) {\r\n                console.error('Error fetching initial messages for group:', err);\r\n            }\r\n        };\r\n\r\n        fetchInitialMessages();\r\n\r\n        // Unsubscribe from previous group's topic if any active subscription exists\r\n        if (currentGroupSubscription.current) {\r\n            currentGroupSubscription.current.unsubscribe();\r\n        }\r\n\r\n        // Subscribe to the specific group's chat topic for real-time updates\r\n        const subscription = stompClient.current.subscribe(`/topic/group/${group.id}`, (message) => {\r\n            const newMessage = JSON.parse(message.body);\r\n            // Only add if it's truly for the current group (defensive check)\r\n            if (newMessage.group && newMessage.group.id === group.id) {\r\n                setMessages(prevMessages => [...prevMessages, newMessage]);\r\n            }\r\n        });\r\n        currentGroupSubscription.current = subscription; // Store the new subscription object\r\n\r\n        // Cleanup function for when the component unmounts or selectedGroup/isConnected changes\r\n        return () => {\r\n            if (currentGroupSubscription.current) {\r\n                currentGroupSubscription.current.unsubscribe();\r\n                currentGroupSubscription.current = null;\r\n            }\r\n        };\r\n    }, [selectedGroup, groups, isConnected]); // Re-run this effect when selectedGroup, groups, or connection status changes\r\n\r\n\r\n    // --- Handlers for User Actions ---\r\n\r\n    const handleSend = async () => {\r\n        if (!inputValue.trim() || !selectedGroup || !stompClient.current || !isConnected) return;\r\n\r\n        const group = groups.find(g => g.name === selectedGroup);\r\n        if (!group) {\r\n            console.error(\"Selected group not found\");\r\n            return;\r\n        }\r\n\r\n        const messagePayload = {\r\n            sender: `${loggedUser.firstName} ${loggedUser.lastName}`,\r\n            message: inputValue,\r\n            // You might include groupId in the message model on backend if needed for more complex routing\r\n            // but for simplicity, groupChatId is passed as a request param in the current backend\r\n        };\r\n\r\n        try {\r\n            // Send message via HTTP POST for persistence\r\n            await axios.post(`http://localhost:8080/message/post?groupChatId=${group.id}`, messagePayload);\r\n\r\n            // Clear input only after successful send\r\n            setInputValue('');\r\n            // The new message will be pushed via WebSocket to `/topic/group/{groupId}`\r\n            // and handled by the subscription in the useEffect above, so no need to re-fetch all messages here.\r\n        } catch (err) {\r\n            console.error('Sending message failed:', err);\r\n        }\r\n    };\r\n\r\n    const handleCreateGroup = async (e) => {\r\n        e.preventDefault();\r\n        if (!inputValue.trim()) return;\r\n\r\n        try {\r\n            await axios.post('http://localhost:8080/group/create', { name: inputValue });\r\n\r\n            await fetchGroups(); // Re-fetch groups to update the dropdown\r\n            setSelectedGroup(inputValue); // Automatically select the newly created group\r\n            setInputValue('');\r\n        } catch (err) {\r\n            console.error('Create group error:', err);\r\n        }\r\n    };\r\n\r\n\r\n    return (\r\n        <div className=\"group-chat-container\">\r\n            <NavBar />\r\n            <Container>\r\n                <div className=\"chat-main-card\">\r\n                    <div className=\"d-flex justify-content-between align-items-center mb-3\">\r\n                        <h3 className=\"chat-header\">💬 Group Chat</h3>\r\n                        <div className=\"connection-status\">\r\n                            {isConnected ? (\r\n                                <span className=\"text-success\">🟢 Connected</span>\r\n                            ) : (\r\n                                <span className=\"text-danger\">🔴 Disconnected</span>\r\n                            )}\r\n                            <Button\r\n                                variant=\"outline-primary\"\r\n                                size=\"sm\"\r\n                                className=\"ms-3\"\r\n                                onClick={requestDesktopNotificationPermission}\r\n                                title=\"Enable browser pop-up notifications\"\r\n                            >\r\n                                Get Desktop Notifications 🔔\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Real-time Notifications Bar */}\r\n                    {notifications.length > 0 && (\r\n                        <div className=\"notifications-bar mb-3 p-3 border rounded shadow-sm\">\r\n                            <div className=\"d-flex justify-content-between align-items-center mb-2\">\r\n                                <h6 className=\"mb-0\">\r\n                                    🔔 Live Notifications\r\n                                    {unreadNotifications > 0 && (\r\n                                        <span className=\"badge bg-danger ms-2\">{unreadNotifications}</span>\r\n                                    )}\r\n                                </h6>\r\n                            </div>\r\n                            <div className=\"notifications-list\">\r\n                                {notifications.slice(0, 3).map((notification) => (\r\n                                    <Alert\r\n                                        key={notification.id}\r\n                                        variant={notification.read ? \"secondary\" : \"info\"}\r\n                                        className=\"notification-alert mb-2\"\r\n                                        dismissible\r\n                                        onClose={() => removeNotification(notification.id)}\r\n                                    >\r\n                                        <div className=\"d-flex justify-content-between align-items-start\">\r\n                                            <div\r\n                                                className=\"notification-content flex-grow-1\"\r\n                                                style={{ cursor: 'pointer' }}\r\n                                                onClick={() => switchToGroupFromNotification(notification.groupName, notification.id)}\r\n                                            >\r\n                                                <strong>{notification.sender}</strong> in <strong>{notification.groupName}</strong>\r\n                                                <br />\r\n                                                <small>{notification.message}</small>\r\n                                            </div>\r\n                                            <small className=\"text-muted ms-2\">\r\n                                                {formatTimestamp(notification.timestamp)}\r\n                                            </small>\r\n                                        </div>\r\n                                    </Alert>\r\n                                ))}\r\n                                {notifications.length > 3 && (\r\n                                    <small className=\"text-muted\">\r\n                                        +{notifications.length - 3} more notifications...\r\n                                    </small>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"group-controls mb-4\">\r\n                        <Row>\r\n                            <Col md={6} className=\"mb-3 mb-md-0\">\r\n                                <div className=\"group-dropdown\">\r\n                                    <Dropdown onSelect={setSelectedGroup}>\r\n                                        <Dropdown.Toggle className=\"w-100\">\r\n                                            {selectedGroup || 'Select Group'}\r\n                                        </Dropdown.Toggle>\r\n                                        <Dropdown.Menu>\r\n                                            {groups.map((g, i) => (\r\n                                                <Dropdown.Item key={i} eventKey={g.name}>{g.name}</Dropdown.Item>\r\n                                            ))}\r\n                                        </Dropdown.Menu>\r\n                                    </Dropdown>\r\n                                </div>\r\n                            </Col>\r\n\r\n                            <Col md={6}>\r\n                                <Form onSubmit={handleCreateGroup} className=\"create-group-form d-flex\">\r\n                                    <Form.Control\r\n                                        type=\"text\"\r\n                                        placeholder=\"Create new group...\"\r\n                                        value={inputValue}\r\n                                        onChange={e => setInputValue(e.target.value)}\r\n                                        className=\"create-group-input me-2\"\r\n                                    />\r\n                                    <Button type=\"submit\" className=\"create-group-btn\">\r\n                                        ✨ Create Group\r\n                                    </Button>\r\n                                </Form>\r\n                            </Col>\r\n                        </Row>\r\n                    </div>\r\n\r\n                    {selectedGroup ? (\r\n                        <div className=\"chat-section card p-3\">\r\n                            <h5 className=\"chat-title mb-3\">📨 Messages in {selectedGroup}</h5>\r\n                            <ListGroup className=\"messages-container flex-grow-1 mb-3\">\r\n                                {messages.length > 0 ? messages.map((msg, idx) => (\r\n                                    <ListGroup.Item\r\n                                        key={msg.id || idx} // Use msg.id if available for better keying\r\n                                        className={`message-item ${msg.sender === `${loggedUser.firstName} ${loggedUser.lastName}` ? 'my-message' : 'other-message'}`}\r\n                                    >\r\n                                        <div className=\"message-content\">\r\n                                            <div className=\"message-text\">\r\n                                                <span className=\"message-sender\">\r\n                                                    {msg.sender === `${loggedUser.firstName} ${loggedUser.lastName}` ? 'You' : msg.sender || 'Unknown'}\r\n                                                </span>\r\n                                                {getMessageText(msg)}\r\n                                            </div>\r\n                                            <span className=\"message-timestamp\">\r\n                                                {formatTimestamp(msg.timestamp)}\r\n                                            </span>\r\n                                        </div>\r\n                                    </ListGroup.Item>\r\n                                )) : (\r\n                                    <div className=\"empty-state\">\r\n                                        <div className=\"empty-state-icon\">💭</div>\r\n                                        <p>No messages yet. Start the conversation!</p>\r\n                                    </div>\r\n                                )}\r\n                            </ListGroup>\r\n\r\n                            <Form className=\"message-input-form d-flex\" onSubmit={e => { e.preventDefault(); handleSend(); }}>\r\n                                <Form.Control\r\n                                    type=\"text\"\r\n                                    placeholder=\"Type your message...\"\r\n                                    value={inputValue}\r\n                                    onChange={e => setInputValue(e.target.value)}\r\n                                    className=\"message-input me-2\"\r\n                                />\r\n                                <Button type=\"submit\" className=\"send-btn\">\r\n                                    Send 🚀\r\n                                </Button>\r\n                            </Form>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"empty-state card p-4\">\r\n                            <div className=\"empty-state-icon\">👆</div>\r\n                            <p>Select a group to start chatting!</p>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </Container>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default GroupChatApp;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}